📖 کتابچه فارسی
===================

راهنمای فارسی پایروبله!

.. raw:: html

    <style>
    @font-face {
        src: url("https://pyrobale.ir/arad.ttf") format("truetype");
        font-family: "Arad";
    }

    div.content, h1, h2, h3, h4, h5, h6 {
        font-family: "Arad";
    }

    div.content {
        direction: rtl;
    }

    p.admonition-title, pre {
    direction: ltr
    }

    </style>


.. toctree::
   :maxdepth: 2
   :caption: فهرست

   مقدمه
   پیش نیاز شروع با پایروبله
   فهم نحوه کارکرد ربات های بله
   دریافت توکن از بات فادر
   شروع با پایروبله
   نصب پایروبله
   نوشتن کد

مقدمه
-----

به راهنمای فارسی پایروبله خوش آمدید.
اینجا از صفر شروع می کنیم و به صورت کامل نحوه کارکرد ربات های بله و شروع با پایروبله رو به شما آموزش می دیم!


پیش نیاز شروع با پایروبله
****
برای شروع نوشتن ربات با کتابخانه **پایروبله**:

لازم است که
 * پایتون را تا حد خوبی بلد باشید
 * درک کاملی از نحوه کارکرد کتابخانه های پایتون داشته باشید

بهتر است که
 * پایتون شئ گرا را درک کرده باشید
 * نحوه کارکرد API را درک کرده باشید
 * توانایی مطالعه مستندات و مطرح کردن سوال در فروم را داشته باشید


فهم نحوه کارکرد ربات های بله
****

بله برای ارتباط گرفتن با ربات ها از api استفاده می کند. این بدین معناست که هر اتفاق جدیدی که در رابطه با ربات می افتد (مثلا شخصی پیام جدیدی می دهد یا پیام خود را ویرایش می کند یا دکمه ربات را فشار می دهد و تغییراتی از این جنس) پیامرسان بله آن اتفاق را در قالب یک محتوای متنی (با فرمت JSON) و با نام **آپدیت** به api خود اضافه می کند و شما باید هر ثانیه به api بله درخواست بزنید و تغییرات جدید را دنبال کنید.


دریافت توکن از بات فادر
****
برای ایجاد یک ربات جدید در پیامرسان بله، باید در
`بات فادر <https://ble.ir/botfather>`_
یک بازوی جدید ثبت کنید.

دستور /newbot را ارسال کنید و ربات خود را ایجاد کنید و توکن را دریافت کنید.

این توکن مثل رمزعبور برای ربات شماست. لزومی ندارد آن را جایی به جز در کد وارد کنید و به کسی بدهید.

شروع با پایروبله
-----

در این قسمت می خواهیم به استفاده از توکنی که دریافت کرده ایم یک ربات ساده ایجاد کنیم.

نصب پایروبله
****
ابتدا باید کتابخانه پایروبله را نصب کنید.

با کمک دستور

.. code-block:: bash

   pip install pyrobale

کتابخانه را نصب کنید.


نوشتن کد
****

حالا یک فایل با پسوند .py ایجاد کنید.

در خط اول، باید کتابخانه پایروبله را وارد کد کنید
پس دستور زیر را داخل فایل می نویسید

.. code-block:: python

   import pyrobale

سپس با استفاده از ایجاد متغیر توکن خود را در کد ذخیره می کنیم

.. code-block:: python

   token = "YOUR_TOKEN"

به جای YOUR_TOKEN توکنی که از بات فادر دریافت کردید رو وارد کنید.

سپس نیاز به این داریم که یک کارخواه (کلاینت) ایجاد کنیم تا با بله در ارتباط باشد. پس از کد زیر استفاده می کنیم تا کلاینت رو با توکن شما ایجاد کنیم.

.. code-block:: python

   client = pyrobale.Client(token)

حالا ربات ما ایجاد شده و  در مرحله بعدی باید رفتار ربات رو تعیین کنیم.

ابتدا می خواهیم اگر کسی برای ربات ما دستور /start را ارسال کرد، به او سلام کنیم.

پس از دستور زیر استفاده می کنیم تا دستور start را برای ربات تعریف کنیم.

.. code-block:: python

   @client.on_command("start")

سپس دقیقا زیر همین خط، یک تابع ایجاد می کنیم تا کد های خود را بنویسیم.

.. code-block:: python

   async def start(message: pyrobale.Message):

تابع ما یک پارامتر message می گیرد که این را خود پایروبله به تابع شما می دهد.

.. note::
    نکته: کلیدواژه async پیش از تعریف تابع، باعث می شود ربات شما به صورت همزمان توانایی انجام چندین کار را داشته باشد. قرار ندادن این کلیدواژه پیش از تعریف تابع باعث دریافت خطا از طرف پایروبله می شود!

بعد از ایجاد تابع، باید در جواب به پیام کاربر، به او سلام کنیم، پس از دستور زیر استفاده می کنیم

.. code-block:: python

    await message.reply("سلام!")

.. note::
    نکته: کلیدواژه await پیش از دستورات پایروبله برای هماهنگ شدن دستورات با توابع async هستند. قرار ندادن این کلیدواژه پیش از دستوراتی که خروجی Coroutine دارند باعث دریافت خطا از طرف پایروبله می شود.


حال ربات ما آماده ست!

برای ارسال دستور روشن شدن ربات کافیست که خط زیر را به عنوان خط آخر به فایل اضافه کنیم:

.. code-block:: python

   client.run()

فایل نهایی چیزی شبیه به این خواهد بود:

.. code-block:: python

   import pyrobale

   token = "YOUR_TOKEN"
   client = pyrobale.Client(token)

   @client.on_command("start")
   async def start(message: pyrobale.Message):
       await message.reply("سلام!")

   client.run()


و فایل را ذخیره و اجرا کنید.

حالا ربات ساده شما آماده ست!